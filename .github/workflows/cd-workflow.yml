name: Deploy Notebooks to Databricks

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Databricks CLI
        run: |
          curl -fsSL https://raw.githubusercontent.com/databricks/cli/main/install.sh | sh

      - name: Upload Notebooks to Databricks
        run: |
          # Export auth vars so Databricks CLI picks them up
          export DATABRICKS_HOST="https://dbc-e380e487-14e8.cloud.databricks.com"
          export DATABRICKS_TOKEN="${{ secrets.DB_token }}"

          # Make sure workspace folders exist
          databricks workspace mkdirs $WORKSPACE_PATH/Bronze
          databricks workspace mkdirs $WORKSPACE_PATH/Silver
          databricks workspace mkdirs $WORKSPACE_PATH/Gold
          databricks workspace mkdirs $WORKSPACE_PATH/Utils

          # Import notebooks from repo into Databricks workspace
          databricks workspace import-dir citibike_etl/notebooks/bronze $WORKSPACE_PATH/Bronze --overwrite
          databricks workspace import-dir citibike_etl/notebooks/silver $WORKSPACE_PATH/Silver --overwrite
          databricks workspace import-dir citibike_etl/notebooks/gold   $WORKSPACE_PATH/Gold   --overwrite
          databricks workspace import-dir citibike_etl/notebooks/utils  $WORKSPACE_PATH/Utils  --overwrite
        env:
          WORKSPACE_PATH: /Workspace/Users/ansarivahid547@gmail.com/Dev




# name: CD Workflow

# on:
#   push:
#     branches:
#       - main

# jobs:
#   cd-deploy-dev:
#     name: Deploy to DEV
#     runs-on: ubuntu-latest
#     environment: dev
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3

#       - name: Setup Python
#         uses: actions/setup-python@v4
#         with:
#           python-version: '3.11'

#       - name: Install Databricks CLI
#         run: curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh

#       - name: Install Dependencies
#         run: |
#           pip install --upgrade pip
#           pip install setuptools wheel

#       - name: Configure Databricks
#         run: |
#           # write out the profile (here called "TEST")
#           cat <<EOF > ~/.databrickscfg
#           [DEFAULT]
#             host  = https://dbc-e380e487-14e8.cloud.databricks.com/
#             token = ${{ secrets.DB_token }}
#           EOF

#       - name: Deploy to DEV
#         run: |
#           databricks bundle deploy

#   cd-deploy-test:
#     name: Deploy to TEST
#     runs-on: ubuntu-latest
#     environment: test
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3

#       - name: Setup Python
#         uses: actions/setup-python@v4
#         with:
#           python-version: '3.11'

#       - name: Install Databricks CLI
#         run: curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh

#       - name: Install Dependencies
#         run: |
#           pip install --upgrade pip
#           pip install setuptools wheel

#       - name: Configure Databricks
#         run: |
#           # write out the profile (here called "TEST")
#           cat <<EOF > ~/.databrickscfg
#           [TEST]
#             host  = https://dbc-ba82de44-d338.cloud.databricks.com/
#             token = ${{ secrets.DB_token_test }}
#           EOF

#       - name: Deploy to TEST
#         run: |
#           databricks bundle deploy --target test --profile TEST
